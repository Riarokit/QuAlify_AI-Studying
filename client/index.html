<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>QuAlify</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <!-- 上部ヘッダー -->
  <header class="app-header">
    <button id="menuButton" onclick="toggleSidebar()">☰</button>
    QuAlify
  </header>

  <!-- メインアプリレイアウト -->
  <div class="app-container">
    
    <!-- サイドバー -->
    <aside class="sidebar">
      <ul>
        <li class="tab active" data-tab="wordTab">単語の管理</li>
        <li class="tab" data-tab="dojoTab">道場</li>
        <li class="tab" data-tab="promptTab">プロンプト編集</li>
        <li class="tab" data-tab="settingsTab">各種設定</li>
      </ul>
    </aside>

    <!-- メインコンテンツ -->
    <main class="page-container">
      
      <!-- タブ1: 単語 -->
      <div id="wordTab" class="tab-content active">
        <h2>単語の登録</h2>

        <div style="margin-bottom: 20px;">
          <input id="wordInput" type="text" placeholder="例: RAID, プロトコル" />
          <input id="tagInput" type="text" list="tagList" placeholder="タグ（任意）" />
          <datalist id="tagList"></datalist>
          <button onclick="addWord()">登録</button>
        </div>

        <fieldset class="control-section">
          <div id="tagFilterContainer">
            <strong class="section-title">絞り込み：</strong>
            <div id="tagCheckboxes"></div>
          </div>
          <div style="margin-top: 16px;">
            <label for="sortSelect"><strong class="section-title">並べ替え：</strong></label><br>
            <select id="sortSelect" style="margin-top: 6px;">
              <option value="id">登録順（新しい順）</option>
              <option value="tag">タグ順</option>
              <option value="proficiency">習熟度が低い順</option>
            </select>
          </div>
        </fieldset>

        <div id="mainContentWrapper">
          <div id="wordListContainer">
            <h2>登録した単語</h2>
            <div id="wordList"></div>
            <div id="questionText" style="margin-top: 20px; color: red;"></div>
          </div>
        </div>
      </div>

      <!-- タブ2: プロンプト -->
      <div id="promptTab" class="tab-content" style="display: none;">
        <div class="layout">

          <!-- 左側：プロンプト入力＋リスト -->
          <div class="main-column">
            <h2>プロンプト作成</h2>
            <input id="promptTitleInput" type="text" placeholder="プロンプトタイトル" class="prompt-input" />
            <textarea id="promptContentInput" placeholder="プロンプト内容" rows="6" class="prompt-input"></textarea>

            <div class="form-actions">
              <button onclick="createPrompt()">新規作成</button>
            </div>

            <h2>登録済みのプロンプト</h2>
            <div id="promptList"></div>
          </div>

          <!-- 右側：チャット欄 -->
          <div class="chat-column">
            <h2>プロンプト修正</h2>
            <div id="chatSection">
              <div id="chatPrompt"></div>
              <div id="chatLog">
              </div>
              <textarea id="chatInput" placeholder="ここに修正要望を入力してください..."></textarea>
              <button id="chatSendBtn" onclick="sendChatMessage()">送信</button>
            </div>
          </div>
        </div>
      </div>

      <!-- タブ3: 道場 -->
      <div id="dojoTab" class="tab-content" style="display:none;">
        <h2>道場</h2>

        <div class="control-section">
          <div id="dojoTagFilter">
            <strong class="section-title">タグ選択：</strong>
            <div id="dojoTagCheckboxes"></div>
          </div>
          <div style="margin-top:12px;">
            <button id="dojoStartBtn">出題開始</button>
            <button id="dojoExitBtn" style="margin-left:8px; display:none;">退場</button>
          </div>
        </div>

        <div id="dojoArea">
          <div style="display: flex; gap: 20px; margin-top: 20px;">
            <!-- 左側：問題表示 -->
            <div style="flex: 1;">
              <h3>問題</h3>
              <div id="dojoQuestionArea"></div>
              <div id="dojoLoadingSpinner" style="display: none; text-align: center; padding: 20px;">
                <div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                <p style="margin-top: 10px; color: #666;">読み込み中...</p>
              </div>
              <div style="margin-top: 12px;">
                <button id="dojoShowExplanationBtn">解説を見る</button>
              </div>
            </div>
            <!-- 右側：解説表示 -->
            <div style="flex: 1;">
              <h3>解説</h3>
              <div id="dojoExplanationArea"></div>
              <div id="dojoFeedbackButtons" style="margin-top: 12px; display: none;">
                <button id="dojoCorrectBtn" style="background-color: #4caf50;">○ 正解</button>
                <button id="dojoWrongBtn" style="background-color: #f44336; margin-left: 8px;">✕ 不正解</button>
              </div>
            </div>
          </div>

          <div id="dojoSummary" style="margin-top:20px; display:none;">
            <h3>結果</h3>
            <div id="dojoStats"></div>
            <canvas id="dojoChart" width="240" height="240"></canvas>
          </div>
        </div>
      </div>

      <!-- タブ4: 設定 -->
      <div id="settingsTab" class="tab-content" style="display:none;">
        <h2>各種設定</h2>

        <h3>Gemini API キー</h3>
        <input id="settingsApiKeyInput" type="password" placeholder="Gemini API Key">
        <button onclick="saveApiKey()">保存</button>
        <button onclick="deleteApiKey()">削除</button>
        <p id="apiKeyStatus">🔄 読み込み中…</p>

        <hr>

        <h3>モデル選択</h3>
        <select id="modelSelect">
          <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
          <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
          <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
        </select>
        <button onclick="saveModel()">変更を保存</button>
        <p id="modelStatus">🔄 読み込み中…</p>
      </div>

    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="main.js"></script>

  <script>
    // タブ切り替え機能
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');

      const selectedTab = document.querySelector(`.tab[data-tab="${tabName}"]`);
      const selectedContent = document.getElementById(tabName);
      if (selectedTab && selectedContent) {
        selectedTab.classList.add('active');
        selectedContent.style.display = 'block';
        localStorage.setItem('currentTab', tabName);
      }
    }

    // 初期設定
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    window.addEventListener('DOMContentLoaded', () => {
      const savedTab = localStorage.getItem('currentTab') || 'wordTab';
      switchTab(savedTab);
    });
  </script>

</body>
</html>
