<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuAlify - 資格試験向けAI自作問題道場</title>
  <!-- Google Fonts: Inter (English) & Noto Sans JP (Japanese) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

  <!-- 上部ヘッダー -->
  <header class="app-header">
    <button id="menuButton" onclick="toggleSidebar()">☰</button>
    QuAlify
  </header>

  <!-- メインアプリレイアウト -->
  <div class="app-container">

    <!-- サイドバー -->
    <aside class="sidebar">
      <ul>
        <li class="tab active" data-tab="wordTab"><i class="fas fa-book" style="width: 20px; text-align: center;"></i>
          単語の管理</li>
        <li class="tab" data-tab="dojoTab"><i class="fas fa-khanda" style="width: 20px; text-align: center;"></i> 道場
        </li>
        <li class="tab" data-tab="promptTab"><i class="fas fa-pen-to-square"
            style="width: 20px; text-align: center;"></i> プロンプト編集</li>
        <li class="tab" data-tab="settingsTab"><i class="fas fa-gear" style="width: 20px; text-align: center;"></i> 各種設定
        </li>
      </ul>
    </aside>

    <!-- メインコンテンツ -->
    <main class="page-container">

      <!-- タブ1: 単語 -->
      <div id="wordTab" class="tab-content active">
        <h2>単語の登録</h2>

        <div style="margin-bottom: 20px;">
          <input id="wordInput" type="text" placeholder="例: RAID, プロトコル" />
          <input id="tagInput" type="text" list="tagList" placeholder="タグ（任意）" />
          <datalist id="tagList"></datalist>
          <button onclick="addWord()">登録</button>
        </div>

        <fieldset class="control-section">
          <div id="tagFilterContainer">
            <strong class="section-title">絞り込み：</strong>
            <div id="tagCheckboxes"></div>
          </div>
          <div style="margin-top: 16px; display: flex; align-items: center; flex-wrap: wrap;">
            <label for="sortSelect"><strong class="section-title"
                style="margin-bottom: 0; margin-right: 8px;">並べ替え：</strong></label>
            <select id="sortSelect">
              <option value="id">登録順（新しい順）</option>
              <option value="tag">タグ順</option>
              <option value="proficiency">習熟度が低い順</option>
            </select>
          </div>
        </fieldset>

        <h2>登録した単語</h2>
        <div id="wordList"></div>
      </div>

      <!-- タブ2: プロンプト -->
      <div id="promptTab" class="tab-content" style="display: none;">
        <h2>プロンプト作成</h2>
        <input id="promptTitleInput" type="text" placeholder="プロンプトタイトル" class="prompt-input" />
        <textarea id="promptContentInput" placeholder="プロンプト内容" rows="6" class="prompt-input"></textarea>

        <div class="form-actions">
          <button onclick="createPrompt()">新規作成</button>
        </div>

        <h2>登録済みのプロンプト</h2>
        <div id="promptList"></div>
      </div>

      <!-- タブ3: 道場 -->
      <div id="dojoTab" class="tab-content" style="display:none;">
        <h2>道場</h2>

        <div class="control-section">
          <div id="dojoTagFilter">
            <strong class="section-title">タグ選択：</strong>
            <div id="dojoTagCheckboxes"></div>
          </div>
          <div class="dojo-setting-row" style="margin-top:12px;">
            <label class="section-title">最大出題数：</label>
            <input type="number" id="dojoMaxQuestions" min="1" placeholder="未入力で全て"
              style="width:100px; padding:4px 8px;" title="空欄の場合は該当単語を全て出題">
          </div>
          <div class="dojo-setting-row" style="margin-top:12px;">
            <button id="dojoStartBtn">出題開始</button>
            <button id="dojoExitBtn" style="display:none;">退場</button>
          </div>
        </div>

        <div id="dojoArea" class="dojo-layout">
          <!-- 縦並び：問題 → 解説 → フィードバック（スマホでも見やすい） -->
          <section class="dojo-section dojo-question-section">
            <h3 class="dojo-section-title">問題</h3>
            <div class="dojo-question-area">
              <div id="dojoLoadingSpinner" class="dojo-loading" style="display: none;">
                <div class="dojo-spinner"></div>
                <p>読み込み中...</p>
              </div>
              <div id="dojoQuestionArea" class="dojo-question-content"></div>
            </div>
            <div class="dojo-actions">
              <button id="dojoShowExplanationBtn" class="dojo-btn dojo-btn-primary" style="display:none;">解説を見る</button>
            </div>
          </section>

          <section class="dojo-section dojo-explanation-section">
            <h3 class="dojo-section-title">解説</h3>
            <div id="dojoExplanationArea" class="dojo-explanation-area"></div>
            <div id="dojoFeedbackButtons" class="dojo-feedback-buttons" style="display: none;">
              <button id="dojoCorrectBtn" class="dojo-btn dojo-btn-correct">○ 正解</button>
              <button id="dojoWrongBtn" class="dojo-btn dojo-btn-wrong">✕ 不正解</button>
            </div>
          </section>

          <div id="dojoSummary" class="dojo-summary" style="display:none;">
            <h3 class="dojo-section-title">結果</h3>
            <div class="dojo-result-cards">
              <div class="dojo-stat-card">
                <span class="dojo-stat-value" id="dojoStatPresented">0</span>
                <span class="dojo-stat-label">出題数</span>
              </div>
              <div class="dojo-stat-card dojo-stat-correct">
                <span class="dojo-stat-value" id="dojoStatCorrect">0</span>
                <span class="dojo-stat-label">正解</span>
              </div>
              <div class="dojo-stat-card dojo-stat-wrong">
                <span class="dojo-stat-value" id="dojoStatWrong">0</span>
                <span class="dojo-stat-label">不正解</span>
              </div>
            </div>
            <div class="dojo-rate-wrap">
              <div class="dojo-rate-ring" id="dojoRateRing">
                <span class="dojo-rate-value" id="dojoRateValue">0%</span>
              </div>
              <p class="dojo-rate-label">正解率</p>
            </div>
          </div>
        </div>
      </div>

      <!-- タブ4: 設定 -->
      <div id="settingsTab" class="tab-content" style="display:none;">
        <h2>各種設定</h2>

        <h3>Gemini API キー</h3>
        <input id="settingsApiKeyInput" type="password" placeholder="Gemini API Key">
        <button onclick="saveApiKey()">保存</button>
        <button onclick="deleteApiKey()">削除</button>
        <p id="apiKeyStatus">🔄 読み込み中…</p>

        <hr>

        <h3>モデル選択</h3>
        <select id="modelSelect">
          <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
          <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
          <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
        </select>
        <button onclick="saveModel()">変更を保存</button>
        <p id="modelStatus">🔄 読み込み中…</p>
      </div>

    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="main.js"></script>

  <script>
    // タブ切り替え機能
    function switchTab(tabName) {
      // 道場入場中に他タブへ移動しようとしたら確認
      if (typeof window.isDojoActive === 'function' && window.isDojoActive() && tabName !== 'dojoTab') {
        if (!confirm('本当に移動しますか？\n（道場を退場すると現在の出題は終了します）')) return;
        if (typeof window.endDojoFromTab === 'function') window.endDojoFromTab();
      }

      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');

      const selectedTab = document.querySelector(`.tab[data-tab="${tabName}"]`);
      const selectedContent = document.getElementById(tabName);
      if (selectedTab && selectedContent) {
        selectedTab.classList.add('active');
        selectedContent.style.display = 'block';
        localStorage.setItem('currentTab', tabName);
      }
    }

    // 初期設定
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    window.addEventListener('DOMContentLoaded', () => {
      const savedTab = localStorage.getItem('currentTab') || 'wordTab';
      switchTab(savedTab);
    });
  </script>

</body>

</html>