# QuAlify 仕様書（初学者向け）

## 1. プロジェクトの概要
**QuAlify**は、学習したい単語（用語）を登録し、GoogleのAI（Gemini API）を活用して、その単語に関連する問題を自動生成・出題してくれる学習支援アプリケーションです。

### 主な機能
1. **単語の登録・管理**：覚えたい用語やタグを登録し、一覧表示・削除・習熟度を管理できます。
2. **AI問題生成機能**：登録した単語について、AI（Gemini API）が問題を自動で作成します。
3. **プロンプト管理機能**：AIにどのような問題を生成させるかの指示（プロンプト）を複数保存・切り替えできます。
4. **道場（Dojo）モード**：登録された単語からランダムに出題され、連続して学習に挑戦できる一問一答モードです。

---

## 2. システム構成（使用技術）
このアプリケーションは、大きく分けて2つの部分（フロントエンドとバックエンド）から構成されています。

- **フロントエンド**：HTML / CSS / JavaScript (ユーザーが見る画面の表示や操作の処理)
- **バックエンド**：Node.js / Express (画面の裏側で動くサーバー側の処理、APIの提供)
- **データベース**：SQLite (better-sqlite3) (単語やプロンプトなどのデータを保存)
- **外部AI連携**：Google Gemini API (AIによる自動での問題生成)

---

## 3. ディレクトリ（フォルダ）構成
プロジェクトは役割ごとにフォルダが綺麗に分かれています。

```text
QuAlify_AI-Studying/
├── client/                  # フロントエンド（ブラウザで動く画面側のプログラム）
│   ├── index.html           # 画面の骨組み（構造）
│   ├── style.css            # 画面の見た目・レイアウト（デザイン）
│   └── main.js              # ボタンを押した時の動きやサーバーとの通信処理
│
├── server/                  # バックエンド（裏側で動くサーバー側のプログラム）
│   ├── app.js               # サーバーを起動する本体（ここから全てが始まります）
│   ├── db.js                # データベース(SQLite)への接続や初期設定を行うファイル
│   ├── .env                 # APIキーなどの秘密の情報を書くファイル（パスワードのようなもの）
│   ├── data/                # 実際にデータが保存されるデータベースファイル
│   ├── routes/              # 受け付け窓口（URLごとの処理の振り分け）
│   │   ├── terms.js         # 単語情報の保存・取得・削除などの窓口
│   │   └── prompts.js       # プロンプト情報の保存・取得などの窓口
│   └── services/            # 外部サービスとの連携
│       └── geminiService.js # Gemini APIに質問を投げて返答をもらう処理
│
├── migrate.js               # データベースの設計図（テーブル）を最初に作成するためのプログラム
├── package.json             # このプロジェクトで使っている外部ライブラリ（便利な部品）のリスト
└── README.md                # プロジェクトの簡単な説明書
```

---

## 4. 実行フロー（データと処理の流れ）

### ① サーバー起動時の流れ
1. コマンド `node app.js` を実行してサーバーを起動します。
2. `server/app.js` が動き出します。
3. `server/db.js` が呼び出され、データベース（SQLite）の準備が完了します。
4. ブラウザで `http://localhost:3000` にアクセスすると、Expressという仕組みが `client/index.html` を画面に返して、アプリが表示されます。

### ② アプリの基本操作フロー例（新しい単語を登録する時）
1. **[ユーザー]** 画面のテキストボックスに単語を入力して「追加」ボタンを押す。
2. **[フロント]** `client/main.js` がその入力を受け取り、裏側の窓口（例：`/terms`）にデータを送ります。
3. **[バック]** `server/routes/terms.js` がデータを受け取り、`server/db.js` を使ってデータベースに単語を保存します。
4. **[バック]** 「保存できたよ」という返事をフロントに返します。
5. **[フロント]** 返事を受け取り、画面の一覧リストに新しい単語を追加して表示を更新します。

### ③ 問題を自動生成する（AIを利用する）時のフロー
1. **[ユーザー]** 単語一覧から「問題を生成」ボタンを押す。
2. **[フロント]** `client/main.js` からバックエンドへ「この単語の問題を作って」と依頼します。
3. **[バック]** URL（`/prompts/...`等）の通信を通じて `server/routes` のプログラムが依頼を受け取ります。
4. **[AI通信]** `server/services/geminiService.js` が設定されているプロンプト（指示文）と一緒に、インターネット経由で GoogleのGemini API に通信します。
5. **[結果返送]** Geminiから返ってきた問題のテキストデータをフロントへ送り返します。
6. **[フロント]** `client/main.js` がそのテキストを読みやすいHTMLに変換し、画面に綺麗に表示します。

---

## 5. 初学者がつまずきやすい・注意するポイント

* **APIキーの設定忘れ**: Gemini APIを利用するには、必ず `server/.env` ファイルを作成し、`GEMINI_API_KEY=自分のAPIキー` と記述する必要があります。これがないと問題生成時にエラーになります。
* **サーバーの再起動が必要**: `server/` フォルダ内のプログラム（バックエンド側のJavaScriptファイル）を書き換えた後は、一度ターミナルで `Ctrl + C` を押してサーバーを止め、再度 `node app.js` で起動し直さないと変更が反映されません。
* **フロントエンドとバックエンドの違い**: `client`のJavaScriptはブラウザで動き、`server`のJavaScriptはパソコン（Node.js環境）で動きます。この2つの場所の「役割分担」と「ブラウザとサーバー間の通信（APIのやり取り）」を意識すると、全体像がとても掴みやすくなります。
